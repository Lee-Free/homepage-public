<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸ªäººä¸»é¡µ - zoe.x</title>
    <link rel="stylesheet" href="./static/style.css">
    <link rel="shortcut icon" href="./static/f2.png">
    <link rel="stylesheet" href="./static/fontawesome.css">
    <!-- è‡ªå®šä¹‰æ ç›®æ ·å¼ -->
    <link rel="stylesheet" href="./modules/custom-section.css">
    <!-- å¼•å…¥é…ç½®æ–‡ä»¶ -->
    <script src="./config.js"></script>
    <!-- è‡ªå®šä¹‰æ ç›®é…ç½® -->
    <script src="./modules/custom-section-config.js"></script>

    <!-- é˜²æ­¢ä¸»é¢˜è‰²é—ªçƒï¼šç«‹å³åº”ç”¨ä¿å­˜çš„ä¸»é¢˜è‰²å’ŒèƒŒæ™¯ -->
    <script>
        (function() {
            try {
                // ç«‹å³åº”ç”¨ä¿å­˜çš„ä¸»é¢˜
                const savedTheme = localStorage.getItem('theme');
                if (savedTheme) {
                    document.documentElement.setAttribute('data-theme', savedTheme);
                }

                // ç«‹å³åº”ç”¨ä¿å­˜çš„è‡ªå®šä¹‰èƒŒæ™¯è‰²
                const savedBackgroundColor = localStorage.getItem('custom-background-color');
                if (savedBackgroundColor && (!savedTheme || savedTheme === 'light')) {
                    try {
                        const color = JSON.parse(savedBackgroundColor);
                        const { r, g, b } = color;
                        const alpha1 = 0.9;
                        const alpha2 = 0.8;
                        const alpha3 = 0.7;

                        const color1 = `rgba(${Math.max(0, r - 30)}, ${Math.max(0, g - 30)}, ${Math.max(0, b - 30)}, ${alpha1})`;
                        const color2 = `rgba(${r}, ${g}, ${b}, ${alpha2})`;
                        const color3 = `rgba(${Math.min(255, r + 30)}, ${Math.min(255, g + 30)}, ${Math.min(255, b + 30)}, ${alpha3})`;

                        const gradient = `linear-gradient(135deg, ${color1} 0%, ${color2} 50%, ${color3} 100%)`;
                        document.documentElement.style.setProperty('--bg-primary', gradient);
                    } catch (e) {
                        console.warn('æ¢å¤è‡ªå®šä¹‰èƒŒæ™¯è‰²å¤±è´¥:', e);
                    }
                }
            } catch (e) {
                console.warn('ä¸»é¢˜é¢„åŠ è½½å¤±è´¥:', e);
            }
        })();
    </script>

    <!-- é˜²æ­¢è°ƒè‰²ç›˜é¡µé¢åˆ·æ–°æ—¶é—ªç° -->
    <style>
        #circular-palette-panel {
            opacity: 0 !important;
            visibility: hidden !important;
            pointer-events: none !important;
        }
    </style>
</head>
<body>
    <!-- ç§»é™¤åŸæœ‰çš„ä¸»é¢˜åˆ‡æ¢æŒ‰é’®ï¼Œæ”¹ä¸ºJavaScriptåŠ¨æ€åˆ›å»º -->

    <!-- åœ†å½¢ä¸ƒå½©è°ƒè‰²ç›˜é¢æ¿ -->
    <div class="circular-palette-panel" id="circular-palette-panel">
        <div class="palette-header">
            <h3>èƒŒæ™¯è°ƒè‰²ç›˜</h3>
            <button class="palette-close" id="palette-close">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="palette-content">
            <div class="circular-palette-container">
                <canvas class="circular-palette" id="circular-palette" width="200" height="200"></canvas>
                <div class="palette-center" id="palette-center">
                    <div class="selected-color" id="selected-color"></div>
                </div>
            </div>
            <div class="palette-controls">
                <button class="reset-btn" id="reset-background" title="é‡ç½®ä¸ºé»˜è®¤">
                    <i class="fas fa-undo"></i> é‡ç½®é»˜è®¤
                </button>
            </div>
        </div>
    </div>

    <div class="main-container">
        <!-- å·¦ä¾§ä¸ªäººä¿¡æ¯ -->
        <aside class="sidebar">
            <section class="profile-section">
                <div class="profile-avatar">
                    <img src="./static/1.png" alt="å¤´åƒ">
                    <div class="avatar-decorations" id="avatar-decorations">
                        <!-- è£…é¥°è¡¨æƒ…å°†ç”±JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>

                <div class="profile-info">
                    <div class="status">
                        <span class="emoji">ğŸ˜Š</span>
                        <span class="title">åŠ è½½ä¸­...</span>
                    </div>
                    <div class="quote">
                        <span class="emoji">ğŸ“</span>
                        <span>åŠ è½½ä¸­...</span>
                    </div>

                    <div class="social-links">
                        <!-- ç¤¾äº¤é“¾æ¥å°†ç”±é…ç½®æ–‡ä»¶åŠ¨æ€ç”Ÿæˆ -->
                    </div>

                    <div class="location-info">
                        <div class="location">
                            <i class="fa fa-map-marker"></i>
                            <span>åŠ è½½ä¸­...</span>
                        </div>
                        <div class="name">
                            <i class="fas fa-briefcase"></i>
                            <span>åŠ è½½ä¸­...</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ä¸ªäººæ ‡ç­¾ -->
            <section class="tags-section">
                <!-- æ ‡ç­¾å°†ç”±é…ç½®æ–‡ä»¶åŠ¨æ€ç”Ÿæˆ -->
            </section>

            <!-- æŠ€èƒ½å±•ç¤º -->
            <section class="skills-section">
                <h2><i class="fas fa-heart"></i> <span id="welcome-title">åŠ è½½ä¸­...</span></h2>
                <div class="stat-item">
                    <span class="stat-label" id="visitor-ip-label">åŠ è½½ä¸­...</span>
                    <span class="stat-number blur-effect" id="visitor-ip">è·å–ä¸­...</span>
                </div>
            </section>
            <br>
            <!-- æ—¶é—´çº¿ -->
            <section class="timeline-section">
                <!-- æ—¶é—´çº¿å°†ç”±é…ç½®æ–‡ä»¶åŠ¨æ€ç”Ÿæˆ -->
            </section>
        </aside>

        <!-- å³ä¾§å†…å®¹åŒºåŸŸ -->
        <main class="content-area">
            <!-- GitHub è´¡çŒ®ç»Ÿè®¡ -->
            <section class="github-stats">
                <div class="stats-toggle">
                    <button id="view-stats" class="stats-toggle-btn active">ç»Ÿè®¡</button>
                    <button id="view-calendar" class="stats-toggle-btn">æ—¥å†</button>
                    <button id="view-diary" class="stats-toggle-btn">æ—¥è®°</button>
                </div>

                <div class="stats-lines">
                    <article class="stats-line">
                        <span class="stats-label" id="total-commits-label">åŠ è½½ä¸­...</span>
                        <span class="stats-text" id="total-commits-text">åŠ è½½ä¸­... <span class="highlight-number" id="total-commits">0</span> åŠ è½½ä¸­...</span>
                    </article>

                    <article class="stats-line">
                        <span class="stats-label" id="streak-label">è¿ç»­ç»Ÿè®¡</span>
                        <span class="stats-text" id="streak-text">æœ€é•¿ <span class="highlight-number" id="longest-streak">0</span> å¤©ï¼Œå½“å‰ <span class="highlight-number" id="current-streak">0</span> å¤©</span>
                    </article>

                    <article class="stats-line">
                        <span class="stats-label" id="activity-label">æ´»è·ƒåº¦</span>
                        <span class="stats-text" id="activity-text">æ´»è·ƒ <span class="highlight-number" id="active-days">0</span> å¤©ï¼Œæ´»è·ƒç‡ <span class="highlight-number" id="active-rate">0.00</span>%</span>
                    </article>

                    <article class="stats-line">
                        <span class="stats-label" id="main-language-label">åŠ è½½ä¸­...</span>
                        <span class="stats-text">
                            <span class="language-tag js"></span>
                            <span class="language-tag py"></span>
                            <span class="language-tag ts"></span>
                            <span class="language-tag css"></span>
                        </span>
                    </article>
                </div>

                <div class="contrib-calendar" id="contrib-calendar" style="display:none">
                    <div class="contrib-scroll-container">
                        <div class="contrib-months" id="contrib-months"></div>
                        <div class="contrib-grid-wrap">
                            <div class="contrib-weekdays">
                                <span></span>
                                <span class="weekday-label">ä¸€</span>
                                <span></span>
                                <span class="weekday-label">ä¸‰</span>
                                <span></span>
                                <span class="weekday-label">äº”</span>
                                <span></span>
                            </div>
                            <div class="contrib-grid" id="contrib-grid"></div>
                        </div>
                    </div>
                    <div class="contrib-legend" id="contrib-legend"></div>
                </div>

                <!-- ç­¾åˆ°æ¨¡å— -->
                <div class="checkin" id="checkin">
                    <h3 class="checkin-title"><i class="fas fa-eye"></i> è®¿é—®æ¬¡æ•°</h3>
                    <div class="checkin-status">
                        <span id="visit-today-status">ä»Šæ—¥è®¿é—® 0 æ¬¡</span>
                        <span class="checkin-streak">ç´¯è®¡è®¿é—® <span id="visit-total">0</span> æ¬¡</span>
                    </div>
                    <div class="checkin-meta">
                        <span id="visit-storage-mode" class="storage-badge">å­˜å‚¨ï¼šæœ¬åœ°</span>
                    </div>
            <!-- æ—¥è®°ç»Ÿè®¡ -->
            <section class="stats-section diary-stats">
                <h2><i class="fas fa-book"></i> æ—¥è®°ç»Ÿè®¡</h2>
                <div class="diary-stats-grid">
                    <div class="stat-item"><span class="stat-label">è¿ç»­å¤©æ•°</span><span class="stat-number" id="diary-consecutive">--</span></div>
                    <div class="stat-item"><span class="stat-label">è®°å½•å¤©æ•°</span><span class="stat-number" id="diary-total-days">--</span></div>
                    <div class="stat-item"><span class="stat-label">æ—¥è®°æ€»æ•°</span><span class="stat-number" id="diary-total-entries">--</span></div>
                    <div class="stat-item"><span class="stat-label">æœ€è¿‘è®°å½•</span><span class="stat-number" id="diary-latest">--</span></div>
                </div>
                <div class="diary-stats-meta">
                    <span class="stat-label">å½“å‰è¿ç»­å¼€å§‹äº</span>
                    <span class="stat-text" id="diary-streak-start">--</span>
                </div>
            </section>

                </div>
            </section>

            <!-- ç«™ç‚¹å±•ç¤º -->
            <section class="sites-section">
                <h2><i class="fas fa-globe"></i> <span id="websites-title">åŠ è½½ä¸­...</span></h2>
                <div class="sites-grid">
                    <!-- ç«™ç‚¹å°†ç”±é…ç½®æ–‡ä»¶åŠ¨æ€ç”Ÿæˆ -->
                </div>
            </section>

            <!-- é¡¹ç›®å±•ç¤º -->
            <section class="projects-section">
                <h2><i class="fas fa-code"></i> <span id="projects-title">åŠ è½½ä¸­...</span></h2>
                <div class="projects-grid">
                    <!-- é¡¹ç›®å°†ç”±é…ç½®æ–‡ä»¶åŠ¨æ€ç”Ÿæˆ -->
                </div>
            </section>

            <!-- æŠ€èƒ½å±•ç¤º -->
            <section class="skills-section">
                <h2><img src="https://img.icons8.com/fluency/24/maintenance.png" alt="ğŸ› ï¸" style="width:24px;height:24px;vertical-align:middle;margin-right:8px;"> <span id="skills-title">åŠ è½½ä¸­...</span></h2>
                <div class="skills-icons">
                    <!-- æŠ€èƒ½å°†ç”±é…ç½®æ–‡ä»¶åŠ¨æ€ç”Ÿæˆ -->
                </div>
            </section>
        </main>
    </div>
    <footer>
            <p id="footer-text">åŠ è½½ä¸­...</p>
    </footer>
</body>
<script>
// åº”ç”¨é…ç½®åˆ°é¡µé¢
document.addEventListener('DOMContentLoaded', function() {
    if (typeof CONFIG !== 'undefined') {
        applyConfig();
    }
    
    // å»¶è¿Ÿåˆå§‹åŒ–è°ƒè‰²ç›˜ï¼Œç¡®ä¿å…¶ä»–è„šæœ¬å·²åŠ è½½
    setTimeout(() => {
        initCircularColorPalette();
    }, 100);
});

// åœ†å½¢ä¸ƒå½©è°ƒè‰²ç›˜åŠŸèƒ½
function initCircularColorPalette() {
    console.log('åˆå§‹åŒ–åœ†å½¢ä¸ƒå½©è°ƒè‰²ç›˜...');
    
    const themeToggle = document.getElementById('theme-toggle');
    const palettePanel = document.getElementById('circular-palette-panel');
    const paletteClose = document.getElementById('palette-close');
    const canvas = document.getElementById('circular-palette');
    const selectedColorDiv = document.getElementById('selected-color');
    const resetBtn = document.getElementById('reset-background');
    
    if (!themeToggle || !palettePanel || !canvas) {
        console.error('è°ƒè‰²ç›˜å…ƒç´ æœªæ‰¾åˆ°');
        return;
    }
    
    let clickCount = 0;
    let clickTimer = null;
    let currentColor = { r: 42, g: 82, b: 152 }; // é»˜è®¤è“è‰²
    
    // ç»˜åˆ¶åœ†å½¢ä¸ƒå½©è°ƒè‰²ç›˜
    function drawColorWheel() {
        const ctx = canvas.getContext('2d');
        const centerX = canvas.width / 2;
        const centerY = canvas.height / 2;
        const radius = Math.min(centerX, centerY) - 10;
        
        // æ¸…ç©ºç”»å¸ƒ
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // ç»˜åˆ¶è‰²ç¯
        for (let angle = 0; angle < 360; angle++) {
            const startAngle = (angle - 1) * Math.PI / 180;
            const endAngle = angle * Math.PI / 180;
            
            ctx.beginPath();
            ctx.arc(centerX, centerY, radius, startAngle, endAngle);
            ctx.arc(centerX, centerY, radius * 0.3, endAngle, startAngle, true);
            ctx.closePath();
            
            const hue = angle;
            const color = `hsl(${hue}, 100%, 50%)`;
            ctx.fillStyle = color;
            ctx.fill();
        }
        
        // ç»˜åˆ¶é¥±å’Œåº¦æ¸å˜
        const gradient = ctx.createRadialGradient(centerX, centerY, radius * 0.3, centerX, centerY, radius);
        gradient.addColorStop(0, 'rgba(255,255,255,1)');
        gradient.addColorStop(0.7, 'rgba(255,255,255,0)');
        gradient.addColorStop(1, 'rgba(0,0,0,0.3)');
        
        ctx.globalCompositeOperation = 'multiply';
        ctx.fillStyle = gradient;
        ctx.beginPath();
        ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);
        ctx.arc(centerX, centerY, radius * 0.3, 0, Math.PI * 2, true);
        ctx.fill();
        ctx.globalCompositeOperation = 'source-over';
    }
    
    // ä»æåæ ‡è·å–é¢œè‰²
    function getColorFromPosition(x, y) {
        const centerX = canvas.width / 2;
        const centerY = canvas.height / 2;
        const dx = x - centerX;
        const dy = y - centerY;
        const distance = Math.sqrt(dx * dx + dy * dy);
        const radius = Math.min(centerX, centerY) - 10;
        
        // æ£€æŸ¥æ˜¯å¦åœ¨è‰²ç¯å†…
        if (distance < radius * 0.3 || distance > radius) {
            return null;
        }
        
        let angle = Math.atan2(dy, dx) * 180 / Math.PI;
        if (angle < 0) angle += 360;
        
        const saturation = Math.max(0, Math.min(100, (distance - radius * 0.3) / (radius * 0.7) * 100));
        const lightness = Math.max(30, Math.min(70, 60 - (distance - radius * 0.3) / (radius * 0.7) * 20));
        
        // å°†HSLè½¬æ¢ä¸ºRGB
        const hsl2rgb = (h, s, l) => {
            h /= 360;
            s /= 100;
            l /= 100;
            const a = s * Math.min(l, 1 - l);
            const f = n => {
                const k = (n + h * 12) % 12;
                return l - a * Math.max(Math.min(k - 3, 9 - k, 1), -1);
            };
            return [Math.round(f(0) * 255), Math.round(f(8) * 255), Math.round(f(4) * 255)];
        };
        
        const [r, g, b] = hsl2rgb(angle, saturation, lightness);
        return { r, g, b, angle, saturation, lightness };
    }
    
    // åº”ç”¨èƒŒæ™¯é¢œè‰²
    function applyBackgroundColor(color, saveGlobally = true) {
        // æ£€æŸ¥å½“å‰æ˜¯å¦ä¸ºæš—è‰²ä¸»é¢˜ï¼Œå¦‚æœæ˜¯æš—è‰²ä¸»é¢˜å°±ä¸åº”ç”¨è‡ªå®šä¹‰èƒŒæ™¯
        const currentTheme = document.documentElement.getAttribute('data-theme');
        if (currentTheme === 'dark') {
            console.log('æš—è‰²ä¸»é¢˜ä¸‹ä¸åº”ç”¨è‡ªå®šä¹‰èƒŒæ™¯è‰²');
            return;
        }
        
        const { r, g, b } = color;
        const alpha1 = 0.9;
        const alpha2 = 0.8;
        const alpha3 = 0.7;
        
        // ç”Ÿæˆæ¸å˜è‰²
        const color1 = `rgba(${Math.max(0, r - 30)}, ${Math.max(0, g - 30)}, ${Math.max(0, b - 30)}, ${alpha1})`;
        const color2 = `rgba(${r}, ${g}, ${b}, ${alpha2})`;
        const color3 = `rgba(${Math.min(255, r + 30)}, ${Math.min(255, g + 30)}, ${Math.min(255, b + 30)}, ${alpha3})`;
        
        const gradient = `linear-gradient(135deg, ${color1} 0%, ${color2} 50%, ${color3} 100%)`;
        
        // æ›´æ–°CSSå˜é‡
        document.documentElement.style.setProperty('--bg-primary', gradient);
        
        // æ›´æ–°é€‰ä¸­é¢œè‰²æ˜¾ç¤º
        selectedColorDiv.style.background = gradient;
        
        // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
        localStorage.setItem('custom-background-color', JSON.stringify(color));
        
        // ä¿å­˜åˆ°å…¨å±€æœåŠ¡å™¨ï¼ˆå¦‚æœéœ€è¦ï¼‰
        if (saveGlobally) {
            saveGlobalThemeColor(color);
        }
    }
    
    // ä¿å­˜å…¨å±€ä¸»é¢˜é¢œè‰²åˆ°æœåŠ¡å™¨
    async function saveGlobalThemeColor(color) {
        try {
            const response = await fetch('/api/theme', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(color)
            });
            
            // æ£€æŸ¥æ˜¯å¦æ˜¯501çŠ¶æ€ç ï¼ˆKVæœªé…ç½®ï¼‰
            if (response.status === 501) {
                console.log('KVå­˜å‚¨æœªé…ç½®ï¼Œä»…æ”¯æŒæœ¬åœ°å­˜å‚¨');
                showColorSaveNotification('ä»…æœ¬åœ°ç”Ÿæ•ˆ ğŸ“±');
                return;
            }
            
            const result = await response.json();
            if (result.success) {
                console.log('å…¨å±€ä¸»é¢˜è‰²ä¿å­˜æˆåŠŸ:', result.message);
                // æ˜¾ç¤ºä¿å­˜æˆåŠŸæç¤º
                showColorSaveNotification('å…¨å±€ä¸»é¢˜è‰²å·²æ›´æ–° ğŸ¨');
            } else {
                console.warn('å…¨å±€ä¸»é¢˜è‰²ä¿å­˜å¤±è´¥:', result.message);
                showColorSaveNotification('å…¨å±€ä¿å­˜å¤±è´¥ï¼Œä»…æœ¬åœ°ç”Ÿæ•ˆ âš ï¸');
            }
        } catch (error) {
            console.warn('å…¨å±€ä¸»é¢˜è‰²ä¿å­˜å¤±è´¥:', error);
            // ç½‘ç»œé”™è¯¯æ—¶æ˜¾ç¤ºæ›´å‹å¥½çš„æç¤º
            if (error.message.includes('Failed to fetch') || error.message.includes('NetworkError')) {
                showColorSaveNotification('ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œä»…æœ¬åœ°ç”Ÿæ•ˆ ğŸ“±');
            } else {
                showColorSaveNotification('ä¿å­˜å¤±è´¥ï¼Œä»…æœ¬åœ°ç”Ÿæ•ˆ âš ï¸');
            }
        }
    }
    
    // åŠ è½½å…¨å±€ä¸»é¢˜é¢œè‰²
    async function loadGlobalThemeColor() {
        try {
            const response = await fetch('/api/theme');
            
            // æ£€æŸ¥æ˜¯å¦æ˜¯501çŠ¶æ€ç ï¼ˆKVæœªé…ç½®ï¼‰
            if (response.status === 501) {
                console.log('KVå­˜å‚¨æœªé…ç½®ï¼Œè·³è¿‡å…¨å±€ä¸»é¢˜è‰²åŠ è½½');
                return null;
            }
            
            const result = await response.json();
            
            if (result.success && result.data) {
                console.log('åŠ è½½å…¨å±€ä¸»é¢˜è‰²:', result.data);
                // åº”ç”¨å…¨å±€ä¸»é¢˜è‰²ï¼ˆä¸å†ä¿å­˜åˆ°æœåŠ¡å™¨ï¼Œé¿å…å¾ªç¯ï¼‰
                applyBackgroundColor(result.data, false);
                return result.data;
            } else {
                console.log('æš‚æ— å…¨å±€ä¸»é¢˜è‰²è®¾ç½®ï¼Œä½¿ç”¨æœ¬åœ°è®¾ç½®');
                return null;
            }
        } catch (error) {
            console.warn('åŠ è½½å…¨å±€ä¸»é¢˜è‰²å¤±è´¥:', error);
            return null;
        }
    }
    
    // æ˜¾ç¤ºé¢œè‰²ä¿å­˜é€šçŸ¥
    function showColorSaveNotification(message) {
        const notification = document.createElement('div');
        notification.className = 'color-save-notification';
        notification.textContent = message;
        
        // å“åº”å¼ä½ç½®è°ƒæ•´
        const isMobile = window.innerWidth <= 768;
        const topPosition = isMobile ? '60px' : '80px';
        const rightPosition = isMobile ? '20px' : '30px';
        
        notification.style.cssText = `
            position: fixed;
            top: ${topPosition};
            right: ${rightPosition};
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid var(--border-primary);
            border-radius: 10px;
            padding: 12px 16px;
            color: var(--text-primary);
            font-size: ${isMobile ? '13px' : '14px'};
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            box-shadow: var(--shadow-medium);
            z-index: 10000;
            opacity: 0;
            transform: translateX(50px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            max-width: ${isMobile ? '150px' : '200px'};
            text-align: center;
            will-change: transform, opacity;
        `;
        
        document.body.appendChild(notification);
        
        // æ˜¾ç¤ºåŠ¨ç”»
        requestAnimationFrame(() => {
            notification.style.opacity = '1';
            notification.style.transform = 'translateX(0)';
        });
        
        // 3ç§’åè‡ªåŠ¨æ¶ˆå¤±
        setTimeout(() => {
            notification.style.opacity = '0';
            notification.style.transform = 'translateX(50px)';
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 300);
        }, 3000);
    }
    
    // ç›‘å¬ä¸»é¢˜å˜åŒ–ï¼Œç¡®ä¿æš—è‰²ä¸»é¢˜ä¸‹ç§»é™¤è‡ªå®šä¹‰èƒŒæ™¯
    const observer = new MutationObserver((mutations) => {
        mutations.forEach((mutation) => {
            if (mutation.type === 'attributes' && mutation.attributeName === 'data-theme') {
                const currentTheme = document.documentElement.getAttribute('data-theme');
                if (currentTheme === 'dark') {
                    // åˆ‡æ¢åˆ°æš—è‰²ä¸»é¢˜æ—¶ï¼Œå¼ºåˆ¶ç§»é™¤è‡ªå®šä¹‰èƒŒæ™¯è‰²æ ·å¼
                    document.documentElement.style.removeProperty('--bg-primary');
                    console.log('å·²åˆ‡æ¢åˆ°æš—è‰²ä¸»é¢˜ï¼Œç§»é™¤è‡ªå®šä¹‰èƒŒæ™¯');
                } else {
                    // åˆ‡æ¢å›äº®è‰²ä¸»é¢˜æ—¶ï¼Œæ¢å¤ä¿å­˜çš„è‡ªå®šä¹‰èƒŒæ™¯è‰²
                    const savedColor = localStorage.getItem('custom-background-color');
                    if (savedColor) {
                        try {
                            const color = JSON.parse(savedColor);
                            applyBackgroundColor(color);
                            console.log('å·²åˆ‡æ¢åˆ°äº®è‰²ä¸»é¢˜ï¼Œæ¢å¤è‡ªå®šä¹‰èƒŒæ™¯');
                        } catch (e) {
                            console.log('æ¢å¤è‡ªå®šä¹‰èƒŒæ™¯å¤±è´¥');
                        }
                    }
                }
            }
        });
    });
    
    // å¼€å§‹è§‚å¯Ÿä¸»é¢˜å˜åŒ–
    observer.observe(document.documentElement, {
        attributes: true,
        attributeFilter: ['data-theme']
    });
    
    // ä½¿ç”¨äº‹ä»¶æ•è·ç›‘å¬è¿ç»­ç‚¹å‡»ï¼Œç®€åŒ–è§¦å‘æœºåˆ¶
    themeToggle.addEventListener('click', function(e) {
        clickCount++;
        console.log('ç‚¹å‡»è®¡æ•°:', clickCount);
        
        // æ¸…é™¤ä¹‹å‰çš„å®šæ—¶å™¨
        if (clickTimer) {
            clearTimeout(clickTimer);
        }
        
        // ç®€åŒ–è§¦å‘æœºåˆ¶ï¼šè¿ç»­ç‚¹å‡»4æ¬¡å³å¯æ‰“å¼€è°ƒè‰²ç›˜
        if (clickCount === 3) {
            showClickProgressHint('å†ç‚¹å‡» 1 æ¬¡æ‰“å¼€è°ƒè‰²ç›˜ ğŸ¨');
        } else if (clickCount >= 4) {
            e.preventDefault();
            e.stopPropagation();
            console.log('è¿ç»­ç‚¹å‡»4æ¬¡ï¼Œæ‰“å¼€è°ƒè‰²ç›˜');
            
            // å¼ºåˆ¶åˆ‡æ¢åˆ°äº®è‰²ä¸»é¢˜ï¼ˆå¦‚æœå½“å‰æ˜¯æš—è‰²ä¸»é¢˜ï¼‰
            const currentTheme = document.documentElement.getAttribute('data-theme');
            if (currentTheme === 'dark') {
                // ä½¿ç”¨ThemeManageræ¥åˆ‡æ¢ä¸»é¢˜
                if (window.themeManager && typeof window.themeManager.applyTheme === 'function') {
                    window.themeManager.applyTheme('light');
                }
                showClickProgressHint('å·²åˆ‡æ¢åˆ°äº®è‰²ä¸»é¢˜ï¼Œè°ƒè‰²ç›˜å³å°†å¼€å¯ï¼ğŸŒˆ');
                // å»¶é•¿æ˜¾ç¤ºæ—¶é—´ï¼Œè®©ç”¨æˆ·çœ‹åˆ°ä¸»é¢˜å˜åŒ–
                setTimeout(() => {
                    // è®¾ç½®æ˜¾ç¤ºæ ‡è®°ï¼Œé˜²æ­¢å…³é—­äº‹ä»¶å¹²æ‰°
                    isShowingPalette = true;
                    
                    // æ¸…é™¤å¯èƒ½å­˜åœ¨çš„å…³é—­å®šæ—¶å™¨
                    if (closeTimer) {
                        clearTimeout(closeTimer);
                        closeTimer = null;
                    }
                    
                    if (window.themeManager && window.themeManager.viewportPalette) {
                        window.themeManager.viewportPalette.show();
                    }
                    palettePanel.classList.add('active');
                    
                    // å»¶è¿Ÿé‡ç½®æ ‡è®°ï¼Œå…è®¸æ­£å¸¸å…³é—­
                    setTimeout(() => {
                        isShowingPalette = false;
                    }, 500);
                }, 800);
            } else {
                showClickProgressHint('è°ƒè‰²ç›˜å·²å¼€å¯ï¼ğŸŒˆ');
                // å»¶è¿Ÿæ˜¾ç¤ºè°ƒè‰²ç›˜ï¼Œå…ˆæ˜¾ç¤ºæˆåŠŸæç¤º
                setTimeout(() => {
                    // è®¾ç½®æ˜¾ç¤ºæ ‡è®°ï¼Œé˜²æ­¢å…³é—­äº‹ä»¶å¹²æ‰°
                    isShowingPalette = true;
                    
                    // æ¸…é™¤å¯èƒ½å­˜åœ¨çš„å…³é—­å®šæ—¶å™¨
                    if (closeTimer) {
                        clearTimeout(closeTimer);
                        closeTimer = null;
                    }
                    
                    if (window.themeManager && window.themeManager.viewportPalette) {
                        window.themeManager.viewportPalette.show();
                    }
                    palettePanel.classList.add('active');
                    
                    // å»¶è¿Ÿé‡ç½®æ ‡è®°ï¼Œå…è®¸æ­£å¸¸å…³é—­
                    setTimeout(() => {
                        isShowingPalette = false;
                    }, 500);
                }, 500);
            }
            
            clickCount = 0;
            return false;
        }
        
        // è®¾ç½®å®šæ—¶å™¨ï¼Œ1.2ç§’åé‡ç½®è®¡æ•°ï¼ˆç¼©çŸ­é‡ç½®æ—¶é—´ï¼‰
        clickTimer = setTimeout(() => {
            clickCount = 0;
            hideClickProgressHint(); // éšè—è¿›åº¦æç¤º
        }, 1200);
    }, true); // ä½¿ç”¨æ•è·é˜¶æ®µï¼Œåœ¨ThemeManagerä¹‹å‰æ‰§è¡Œ
    
    // æ˜¾ç¤ºç‚¹å‡»è¿›åº¦æç¤º - æ”¹å–„ä½ç½®è®¡ç®—å’Œæµè§ˆå™¨å…¼å®¹æ€§
    function showClickProgressHint(message) {
        // ç§»é™¤å·²å­˜åœ¨çš„æç¤º
        const existingHint = document.getElementById('click-progress-hint');
        if (existingHint) {
            existingHint.remove();
        }
        
        const hint = document.createElement('div');
        hint.id = 'click-progress-hint';
        hint.className = 'click-progress-hint';
        hint.textContent = message;
        
        // æ·»åŠ æµè§ˆå™¨æ£€æµ‹å’Œä½ç½®ä¼˜åŒ–
        const isMobile = window.innerWidth <= 768;
        const isFirefox = navigator.userAgent.toLowerCase().indexOf('firefox') > -1;
        const isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);
        
        // æ ¹æ®è®¾å¤‡å’Œæµè§ˆå™¨åŠ¨æ€è°ƒæ•´æ ·å¼
        let topPosition = '35%';
        let backgroundColor = 'rgba(255, 255, 255, 0.15)';
        
        if (isMobile) {
            topPosition = '25%';
            backgroundColor = 'rgba(255, 255, 255, 0.2)';
        }
        
        if (isFirefox) {
            backgroundColor = 'rgba(30, 30, 40, 0.95)';
        }
        
        if (document.documentElement.getAttribute('data-theme') === 'dark') {
            backgroundColor = isFirefox ? 'rgba(50, 50, 50, 0.95)' : 'rgba(40, 40, 40, 0.9)';
        }
        
        // è®¾ç½®åŠ¨æ€æ ·å¼
        hint.style.cssText = `
            position: fixed;
            top: ${topPosition};
            left: 50%;
            transform: translate(-50%, -50%);
            background: ${backgroundColor};
            backdrop-filter: ${isFirefox ? 'none' : 'blur(25px)'};
            -webkit-backdrop-filter: ${isFirefox ? 'none' : 'blur(25px)'};
            border: 1px solid var(--border-primary);
            border-radius: ${isMobile ? '10px' : '15px'};
            padding: ${isMobile ? '10px 18px' : '16px 24px'};
            color: var(--text-primary);
            font-size: ${isMobile ? '13px' : '16px'};
            font-weight: 600;
            text-align: center;
            z-index: 10001;
            box-shadow: var(--shadow-heavy);
            opacity: 0;
            scale: 0.8;
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            pointer-events: none;
            white-space: ${isMobile && window.innerWidth <= 480 ? 'normal' : 'nowrap'};
            max-width: calc(100vw - ${isMobile ? '30px' : '60px'});
            will-change: transform, opacity;
            line-height: ${isMobile && window.innerWidth <= 480 ? '1.4' : 'normal'};
        `;
        
        document.body.appendChild(hint);
        
        // æ˜¾ç¤ºåŠ¨ç”»
        requestAnimationFrame(() => {
            hint.style.opacity = '1';
            hint.style.scale = '1';
        });
        
        // è‡ªåŠ¨éšè—
        setTimeout(() => {
            if (hint.parentNode) {
                hint.style.opacity = '0';
                hint.style.scale = '0.8';
                setTimeout(() => {
                    if (hint.parentNode) {
                        hint.remove();
                    }
                }, 300);
            }
        }, 2500);
    }
    
    // éšè—ç‚¹å‡»è¿›åº¦æç¤º
    function hideClickProgressHint() {
        const hint = document.getElementById('click-progress-hint');
        if (hint) {
            hint.style.opacity = '0';
            hint.style.scale = '0.8';
            setTimeout(() => {
                if (hint.parentNode) {
                    hint.remove();
                }
            }, 300);
        }
    }
    
    // ç»˜åˆ¶è‰²è½®
    drawColorWheel();
    
    let previewColor = null;
    let originalBackground = null;
    
    // é¼ æ ‡ç§»åŠ¨äº‹ä»¶ - åªé¢„è§ˆï¼Œä¸ç¡®è®¤
    canvas.addEventListener('mousemove', (e) => {
        // æ£€æŸ¥æ˜¯å¦ä¸ºäº®è‰²ä¸»é¢˜ï¼Œæš—è‰²ä¸»é¢˜ä¸‹ä¸é¢„è§ˆ
        const currentTheme = document.documentElement.getAttribute('data-theme');
        if (currentTheme === 'dark') {
            return;
        }
        
        const rect = canvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        
        const color = getColorFromPosition(x, y);
        if (color) {
            // ä¿å­˜å½“å‰é¢„è§ˆé¢œè‰²
            previewColor = color;
            
            // å¦‚æœæ²¡æœ‰ä¿å­˜åŸå§‹èƒŒæ™¯ï¼Œå…ˆä¿å­˜
            if (!originalBackground) {
                const currentBgPrimary = getComputedStyle(document.documentElement).getPropertyValue('--bg-primary').trim();
                originalBackground = currentBgPrimary || 'linear-gradient(135deg, rgba(30, 60, 114, 0.9) 0%, rgba(42, 82, 152, 0.8) 50%, rgba(102, 126, 234, 0.7) 100%)';
            }
            
            // ä¸´æ—¶é¢„è§ˆèƒŒæ™¯é¢œè‰²
            const { r, g, b } = color;
            const color1 = `rgba(${Math.max(0, r - 30)}, ${Math.max(0, g - 30)}, ${Math.max(0, b - 30)}, 0.9)`;
            const color2 = `rgba(${r}, ${g}, ${b}, 0.8)`;
            const color3 = `rgba(${Math.min(255, r + 30)}, ${Math.min(255, g + 30)}, ${Math.min(255, b + 30)}, 0.7)`;
            
            const gradient = `linear-gradient(135deg, ${color1} 0%, ${color2} 50%, ${color3} 100%)`;
            document.documentElement.style.setProperty('--bg-primary', gradient);
            
            // æ›´æ–°ä¸­å¿ƒé¢œè‰²æ˜¾ç¤º
            selectedColorDiv.style.background = gradient;
        }
    });
    
    // é¼ æ ‡ç¦»å¼€ç”»å¸ƒæ—¶æ¢å¤åŸå§‹èƒŒæ™¯
    canvas.addEventListener('mouseleave', () => {
        // æ£€æŸ¥æ˜¯å¦ä¸ºæš—è‰²ä¸»é¢˜ï¼Œæš—è‰²ä¸»é¢˜ä¸‹ä¸å¤„ç†
        const currentTheme = document.documentElement.getAttribute('data-theme');
        if (currentTheme === 'dark') {
            return;
        }
        
        if (originalBackground) {
            // æ¢å¤åˆ°ç¡®è®¤é€‰æ‹©çš„èƒŒæ™¯æˆ–é»˜è®¤èƒŒæ™¯
            const savedColor = localStorage.getItem('custom-background-color');
            if (savedColor) {
                try {
                    const color = JSON.parse(savedColor);
                    applyBackgroundColor(color);
                } catch (e) {
                    document.documentElement.style.setProperty('--bg-primary', originalBackground);
                }
            } else {
                document.documentElement.style.removeProperty('--bg-primary');
            }
            
            // æ¢å¤é€‰ä¸­é¢œè‰²æ˜¾ç¤º
            const savedColor2 = localStorage.getItem('custom-background-color');
            if (savedColor2) {
                try {
                    const color = JSON.parse(savedColor2);
                    const { r, g, b } = color;
                    const color1 = `rgba(${Math.max(0, r - 30)}, ${Math.max(0, g - 30)}, ${Math.max(0, b - 30)}, 0.9)`;
                    const color2 = `rgba(${r}, ${g}, ${b}, 0.8)`;
                    const color3 = `rgba(${Math.min(255, r + 30)}, ${Math.min(255, g + 30)}, ${Math.min(255, b + 30)}, 0.7)`;
                    const gradient = `linear-gradient(135deg, ${color1} 0%, ${color2} 50%, ${color3} 100%)`;
                    selectedColorDiv.style.background = gradient;
                } catch (e) {
                    selectedColorDiv.style.background = 'linear-gradient(135deg, rgba(30, 60, 114, 0.9) 0%, rgba(42, 82, 152, 0.8) 50%, rgba(102, 126, 234, 0.7) 100%)';
                }
            } else {
                selectedColorDiv.style.background = 'linear-gradient(135deg, rgba(30, 60, 114, 0.9) 0%, rgba(42, 82, 152, 0.8) 50%, rgba(102, 126, 234, 0.7) 100%)';
            }
        }
        previewColor = null;
    });
    
    // ç‚¹å‡»é€‰æ‹©é¢œè‰² - ç¡®è®¤é€‰æ‹©
    canvas.addEventListener('click', (e) => {
        // æ£€æŸ¥æ˜¯å¦ä¸ºæš—è‰²ä¸»é¢˜ï¼Œæš—è‰²ä¸»é¢˜ä¸‹ä¸ç¡®è®¤é€‰æ‹©
        const currentTheme = document.documentElement.getAttribute('data-theme');
        if (currentTheme === 'dark') {
            return;
        }
        
        const rect = canvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        
        const color = getColorFromPosition(x, y);
        if (color) {
            console.log('ç¡®è®¤é€‰æ‹©é¢œè‰²:', color);
            currentColor = color;
            applyBackgroundColor(color);
            
            // æ›´æ–°åŸå§‹èƒŒæ™¯ä¸ºæ–°é€‰æ‹©çš„é¢œè‰²
            const { r, g, b } = color;
            const color1 = `rgba(${Math.max(0, r - 30)}, ${Math.max(0, g - 30)}, ${Math.max(0, b - 30)}, 0.9)`;
            const color2 = `rgba(${r}, ${g}, ${b}, 0.8)`;
            const color3 = `rgba(${Math.min(255, r + 30)}, ${Math.min(255, g + 30)}, ${Math.min(255, b + 30)}, 0.7)`;
            originalBackground = `linear-gradient(135deg, ${color1} 0%, ${color2} 50%, ${color3} 100%)`;
        }
    });
    
    // å…³é—­è°ƒè‰²ç›˜é¢æ¿
    if (paletteClose) {
        paletteClose.addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();
            if (window.themeManager && window.themeManager.viewportPalette) {
                window.themeManager.viewportPalette.hide();
            }
            palettePanel.classList.remove('active');
        });
    }
    
    // ç‚¹å‡»é¢æ¿å¤–éƒ¨å…³é—­ - æ”¹è¿›çš„é˜²å†²çªæœºåˆ¶
    let closeTimer = null;
    let isShowingPalette = false; // æ ‡è®°æ˜¯å¦æ­£åœ¨æ˜¾ç¤ºè°ƒè‰²ç›˜
    
    document.addEventListener('click', (e) => {
        // å¦‚æœæ­£åœ¨æ˜¾ç¤ºè°ƒè‰²ç›˜ï¼Œå¿½ç•¥ç‚¹å‡»å…³é—­äº‹ä»¶
        if (isShowingPalette) {
            return;
        }
        
        if (palettePanel.classList.contains('active') && 
            !palettePanel.contains(e.target) &&
            !e.target.closest('.theme-toggle-container') &&
            !e.target.closest('#viewport-theme-container') &&
            !e.target.closest('.click-progress-hint')) {
            
            // æ¸…é™¤ä¹‹å‰çš„å®šæ—¶å™¨
            if (closeTimer) {
                clearTimeout(closeTimer);
            }
            
            // å»¶è¿Ÿå…³é—­ï¼Œé˜²æ­¢ä¸æ˜¾ç¤ºé€»è¾‘å†²çª
            closeTimer = setTimeout(() => {
                if (window.themeManager && window.themeManager.viewportPalette) {
                    window.themeManager.viewportPalette.hide();
                }
                palettePanel.classList.remove('active');
                closeTimer = null;
            }, 150);
        }
    });
    
    // é‡ç½®æŒ‰é’®
    if (resetBtn) {
        resetBtn.addEventListener('click', async (e) => {
            e.preventDefault();
            e.stopPropagation();

            // æ˜¾ç¤ºé‡ç½®ä¸­çŠ¶æ€
            resetBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> é‡ç½®ä¸­...';
            resetBtn.disabled = true;

            try {
                // é‡ç½®ä¸ºé»˜è®¤é¢œè‰²
                const defaultColor = { r: 42, g: 82, b: 152 };
                currentColor = defaultColor;

                // é‡ç½®CSSå˜é‡ä¸ºé»˜è®¤å€¼
                document.documentElement.style.removeProperty('--bg-primary');

                // æ›´æ–°é€‰ä¸­é¢œè‰²æ˜¾ç¤º
                selectedColorDiv.style.background = 'linear-gradient(135deg, rgba(30, 60, 114, 0.9) 0%, rgba(42, 82, 152, 0.8) 50%, rgba(102, 126, 234, 0.7) 100%)';

                // æ¸…é™¤æœ¬åœ°å­˜å‚¨
                localStorage.removeItem('custom-background-color');

                // å°è¯•æ¸…é™¤æœåŠ¡å™¨ç«¯å…¨å±€ä¸»é¢˜è‰²
                try {
                    const response = await fetch('/api/theme', {
                        method: 'DELETE',
                        headers: {
                            'Content-Type': 'application/json',
                        }
                    });

                    if (response.status === 501) {
                        console.log('KVå­˜å‚¨æœªé…ç½®ï¼Œä»…é‡ç½®æœ¬åœ°è®¾ç½®');
                        showColorSaveNotification('å·²é‡ç½®ä¸ºé»˜è®¤ä¸»é¢˜è‰² ğŸ¨');
                    } else if (response.ok) {
                        console.log('å…¨å±€ä¸»é¢˜è‰²ä¹Ÿå·²é‡ç½®');
                        showColorSaveNotification('å…¨å±€ä¸»é¢˜è‰²å·²é‡ç½® ğŸ¨');
                    } else {
                        console.warn('å…¨å±€ä¸»é¢˜è‰²é‡ç½®å¤±è´¥ï¼Œä½†æœ¬åœ°å·²é‡ç½®');
                        showColorSaveNotification('æœ¬åœ°ä¸»é¢˜è‰²å·²é‡ç½® âš ï¸');
                    }
                } catch (error) {
                    console.warn('æœåŠ¡å™¨è¿æ¥å¤±è´¥ï¼Œä»…é‡ç½®æœ¬åœ°è®¾ç½®:', error);
                    showColorSaveNotification('æœ¬åœ°ä¸»é¢˜è‰²å·²é‡ç½® ğŸ“±');
                }

                console.log('èƒŒæ™¯é¢œè‰²å·²é‡ç½®ä¸ºé»˜è®¤');

            } catch (error) {
                console.error('é‡ç½®å¤±è´¥:', error);
                showColorSaveNotification('é‡ç½®å¤±è´¥ï¼Œè¯·é‡è¯• âŒ');
            } finally {
                // æ¢å¤æŒ‰é’®çŠ¶æ€
                setTimeout(() => {
                    resetBtn.innerHTML = '<i class="fas fa-undo"></i> é‡ç½®é»˜è®¤';
                    resetBtn.disabled = false;
                }, 1000);
            }
        });
    }
    
    // åŠ è½½ä¿å­˜çš„é¢œè‰²ï¼ˆä¼˜å…ˆåŠ è½½å…¨å±€è®¾ç½®ï¼Œç„¶åæ˜¯æœ¬åœ°è®¾ç½®ï¼‰
    async function loadSavedColors() {
        let colorLoaded = false;
        
        // é¦–å…ˆå°è¯•åŠ è½½å…¨å±€ä¸»é¢˜è‰²
        try {
            const globalColor = await loadGlobalThemeColor();
            if (globalColor) {
                currentColor = globalColor;
                colorLoaded = true;
                console.log('å·²åŠ è½½å…¨å±€ä¸»é¢˜è‰²');
            }
        } catch (error) {
            console.warn('åŠ è½½å…¨å±€ä¸»é¢˜è‰²å¤±è´¥ï¼Œå°è¯•æœ¬åœ°å­˜å‚¨');
        }
        
        // å¦‚æœæ²¡æœ‰å…¨å±€è®¾ç½®ï¼Œåˆ™ä½¿ç”¨æœ¬åœ°å­˜å‚¨
        if (!colorLoaded) {
            const savedColor = localStorage.getItem('custom-background-color');
            if (savedColor) {
                try {
                    const color = JSON.parse(savedColor);
                    currentColor = color;
                    applyBackgroundColor(color, false); // ä¸å†ä¿å­˜åˆ°æœåŠ¡å™¨
                    console.log('å·²åŠ è½½æœ¬åœ°ä¸»é¢˜è‰²');
                } catch (e) {
                    console.log('åŠ è½½æœ¬åœ°ä¸»é¢˜è‰²å¤±è´¥:', e);
                }
            }
        }
    }
    
    // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
    loadSavedColors();
    
    console.log('åœ†å½¢ä¸ƒå½©è°ƒè‰²ç›˜åˆå§‹åŒ–å®Œæˆ');
}

function applyConfig() {
    console.log('å¼€å§‹åº”ç”¨é…ç½®:', CONFIG);
    const { personal, github, social, tags, timeline, websites, projects, skills, texts } = CONFIG;

    // æ›´æ–°GitHubç”¨æˆ·å
    if (github && github.username) {
        window.GITHUB_USERNAME = github.username;
    }

    // æ›´æ–°é¡µé¢æ ‡é¢˜å’Œå›¾æ ‡
    if (personal) {
        if (personal.name) {
            document.title = `ä¸ªäººä¸»é¡µ - ${personal.name}`;
        }

        if (personal.favicon) {
            const favicon = document.querySelector('link[rel="shortcut icon"]');
            if (favicon) {
                favicon.href = personal.favicon;
            }
        }

        // æ›´æ–°å¤´åƒ
        if (personal.avatar) {
            const avatar = document.querySelector('.profile-avatar img');
            if (avatar) {
                avatar.src = personal.avatar;
                avatar.alt = personal.name || 'å¤´åƒ';
            }
        }

        // æ›´æ–°èŒä½æ ‡é¢˜
        if (personal.title) {
            const titleElement = document.querySelector('.status .title');
            if (titleElement) {
                titleElement.textContent = personal.title;
            }
        }

        // æ›´æ–°ä¸ªäººæ ¼è¨€
        if (personal.quote) {
            const quoteElement = document.querySelector('.quote span:last-child');
            if (quoteElement) {
                // ä¿æŒåŸæœ‰çš„é«˜äº®æ ·å¼ï¼Œåªæ›¿æ¢æ–‡æœ¬å†…å®¹
                const highlightBlue = '<span class="highlight-blue">or</span>';
                const highlightPink = '<span class="highlight-pink">so</span>';
                quoteElement.innerHTML = personal.quote.replace('or', highlightBlue).replace('so', highlightPink);
            }
        }

        // æ›´æ–°åœ°ç†ä½ç½®
        if (personal.location) {
            const locationElement = document.querySelector('.location span');
            if (locationElement) {
                locationElement.textContent = personal.location;
            }
        }

        // æ›´æ–°çŠ¶æ€
        if (personal.status) {
            const statusElement = document.querySelector('.name span');
            if (statusElement) {
                statusElement.textContent = personal.status;
            }
        }

        // æ›´æ–°å¤´åƒè£…é¥°è¡¨æƒ…
        if (personal.avatarDecorations) {
            const decorationsContainer = document.getElementById('avatar-decorations');
            if (decorationsContainer) {
                // æ¸…ç©ºç°æœ‰è£…é¥°
                decorationsContainer.innerHTML = '';
                
                // å°†é€—å·åˆ†éš”çš„è£…é¥°è¡¨æƒ…è½¬æ¢ä¸ºæ•°ç»„
                const decorations = personal.avatarDecorations.split(',');
                
                // ä¸ºæ¯ä¸ªè£…é¥°è¡¨æƒ…åˆ›å»ºå…ƒç´ 
                decorations.forEach((decoration, index) => {
                    const decorationElement = document.createElement('div');
                    decorationElement.className = `decoration decoration-${index + 1}`;
                    decorationElement.textContent = decoration.trim();
                    decorationsContainer.appendChild(decorationElement);
                });
            }
        }

        // æ›´æ–°èƒŒæ™¯å›¾ç‰‡
        if (personal.bgImage) {
            document.body.style.backgroundImage = `var(--bg-primary), url(${personal.bgImage})`;
        }
    }

    // æ›´æ–°ç¤¾äº¤é“¾æ¥
    if (social) {
        updateSocialLinks(social);
    }

    // æ›´æ–°æ ‡ç­¾
    if (tags) {
        updateTags(tags);
    }

    // æ›´æ–°æ—¶é—´çº¿
    if (timeline) {
        updateTimeline(timeline);
    }

    // æ›´æ–°ç«™ç‚¹å±•ç¤º
    if (websites) {
        updateWebsites(websites);
    }

    // æ›´æ–°é¡¹ç›®å±•ç¤º
    if (projects) {
        updateProjects(projects);
    }

    // æ›´æ–°æŠ€èƒ½å±•ç¤º
    if (skills) {
        updateSkills(skills);
    }

    // æ›´æ–°é¡µé¢æ–‡æœ¬
    if (texts) {
        updateTexts(texts);
    }
}

function updateSocialLinks(social) {
    const socialContainer = document.querySelector('.social-links');
    if (!socialContainer) {
        console.error('ç¤¾äº¤é“¾æ¥å®¹å™¨æœªæ‰¾åˆ°');
        return;
    }

    console.log('æ›´æ–°ç¤¾äº¤é“¾æ¥:', social);

    // æ¸…ç©ºç°æœ‰é“¾æ¥
    socialContainer.innerHTML = '';

    // ç¤¾äº¤å¹³å°å›¾æ ‡æ˜ å°„
    const iconMap = {
        github: 'fas fa-github',
        email: 'fas fa-envelope',
        wechat: 'fas fa-qrcode',
        telegram: 'fas fa-paper-plane',
        twitter: 'fab fa-twitter',
        linkedin: 'fab fa-linkedin',
        blog: 'fas fa-blog'
    };

    // æ·»åŠ é…ç½®çš„ç¤¾äº¤é“¾æ¥
    Object.entries(social).forEach(([platform, url]) => {
        if (!url) return;

        const link = document.createElement('a');
        link.innerHTML = `<i class="${iconMap[platform] || 'fas fa-link'}"></i>`;

        // é‚®ç®±/å¾®ä¿¡ é‡‡ç”¨ä¸€é”®å¤åˆ¶
        if (platform === 'email' || platform === 'wechat') {
            link.href = 'javascript:void(0)';
            link.title = platform === 'email' ? 'å¤åˆ¶é‚®ç®±' : 'å¤åˆ¶å¾®ä¿¡';
            link.addEventListener('click', async (e) => {
                e.preventDefault();
                try {
                    await navigator.clipboard.writeText(url);
                    showToast(platform === 'email' ? 'é‚®ç®±å·²å¤åˆ¶' : 'å¾®ä¿¡å·å·²å¤åˆ¶');
                } catch (err) {
                    console.warn('Clipboard API ä¸å¯ç”¨ï¼Œå°è¯•é™çº§æ–¹æ¡ˆ');
                    const ta = document.createElement('textarea');
                    ta.value = url;
                    document.body.appendChild(ta);
                    ta.select();
                    try { document.execCommand('copy'); showToast(platform === 'email' ? 'é‚®ç®±å·²å¤åˆ¶' : 'å¾®ä¿¡å·å·²å¤åˆ¶'); } catch (e) { alert(url); }
                    document.body.removeChild(ta);
                }
            });
        } else {
            // å…¶ä»–å¹³å°æ­£å¸¸è·³è½¬
            link.href = platform === 'email' ? `mailto:${url}` : url;
            link.target = '_blank';
            link.addEventListener('click', function(e) {
                console.log(`ç‚¹å‡»äº† ${platform} é“¾æ¥:`, url);
                if (platform === 'email') {
                    window.location.href = `mailto:${url}`;
                } else {
                    window.open(url, '_blank');
                }
            });
        }

        socialContainer.appendChild(link);
        console.log(`æ·»åŠ äº† ${platform} é“¾æ¥:`, url);
    });

    // åˆ›å»º Toast å®¹å™¨ï¼ˆè‹¥ä¸å­˜åœ¨ï¼‰
    if (!document.querySelector('.toast-container')) {
        const toast = document.createElement('div');
        toast.className = 'toast-container';
        document.body.appendChild(toast);
    }

    function showToast(message) {
        const container = document.querySelector('.toast-container');
        if (!container) return;
        const item = document.createElement('div');
        item.className = 'toast-item';
        item.textContent = message;
        container.appendChild(item);
        requestAnimationFrame(() => item.classList.add('show'));
        setTimeout(() => {
            item.classList.remove('show');
            setTimeout(() => item.remove(), 300);
        }, 1500);
    }

    // ä¿ç•™åŸæœ‰çš„ç‰¹æ®Šé“¾æ¥ï¼ˆå¤æ—¥ç©ºè°ƒï¼‰
    const specialLink = document.createElement('a');
    specialLink.href = '#';
    specialLink.onclick = () => showIframe();
    specialLink.title = 'å¤æ—¥ç©ºè°ƒ';
    specialLink.innerHTML = '<i class="fas fa-circle"></i>';
    socialContainer.appendChild(specialLink);

    console.log('ç¤¾äº¤é“¾æ¥æ›´æ–°å®Œæˆï¼Œå…±æ·»åŠ äº†', socialContainer.children.length, 'ä¸ªé“¾æ¥');
}

function updateTags(tags) {
    const tagsContainer = document.querySelector('.tags-section');
    if (!tagsContainer) return;

    // æ¸…ç©ºç°æœ‰æ ‡ç­¾
    tagsContainer.innerHTML = '';

    // æ·»åŠ é…ç½®çš„æ ‡ç­¾
    tags.forEach(tag => {
        const tagElement = document.createElement('div');
        tagElement.className = 'tag';
        tagElement.textContent = tag;
        tagsContainer.appendChild(tagElement);
    });
}

function updateTimeline(timeline) {
    const timelineContainer = document.querySelector('.timeline-section');
    if (!timelineContainer) return;

    // æ¸…ç©ºç°æœ‰æ—¶é—´çº¿
    timelineContainer.innerHTML = '';

    // æ·»åŠ é…ç½®çš„æ—¶é—´çº¿äº‹ä»¶
    timeline.forEach(event => {
        const timelineItem = document.createElement('div');
        timelineItem.className = 'timeline-item';

        timelineItem.innerHTML = `
            <div class="timeline-dot"></div>
            <div class="timeline-content">
                <div class="timeline-title">${event.title}</div>
                <div class="timeline-date">${event.date}</div>
            </div>
        `;

        timelineContainer.appendChild(timelineItem);
    });
}

function updateWebsites(websites) {
    const websitesGrid = document.querySelector('.sites-grid');
    if (!websitesGrid) return;

    // æ¸…ç©ºç°æœ‰ç½‘ç«™
    websitesGrid.innerHTML = '';

    // æ·»åŠ é…ç½®çš„ç½‘ç«™
    websites.forEach(site => {
        const siteLink = document.createElement('a');
        siteLink.href = site.url;
        siteLink.target = '_blank';
        siteLink.className = 'site-link btn-effect';

        siteLink.innerHTML = `
            <div class="site-card">
                <div class="site-icon">
                    <img src="${site.icon}" alt="${site.name}">
                </div>
                <div class="site-info">
                    <h3>${site.name}</h3>
                    <p>${site.description}</p>
                </div>
            </div>
        `;

        websitesGrid.appendChild(siteLink);
    });
}

function updateProjects(projects) {
    const projectsGrid = document.querySelector('.projects-grid');
    if (!projectsGrid) return;

    // æ¸…ç©ºç°æœ‰é¡¹ç›®
    projectsGrid.innerHTML = '';

    // æ·»åŠ é…ç½®çš„é¡¹ç›®
    projects.forEach(project => {
        const projectLink = document.createElement('a');
        projectLink.href = project.url;
        projectLink.target = '_blank';
        projectLink.className = 'project-link btn-effect';

        projectLink.innerHTML = `
            <div class="project-card">
                <div class="project-icon">
                    <img src="${project.icon}" alt="${project.name}">
                </div>
                <div class="project-info">
                    <h3>${project.name}</h3>
                    <p>${project.description}</p>
                </div>
            </div>
        `;

        projectsGrid.appendChild(projectLink);
    });
}

function updateSkills(skills) {
    const skillsContainer = document.querySelector('.skills-icons');
    if (!skillsContainer) return;

    // æ¸…ç©ºç°æœ‰æŠ€èƒ½
    skillsContainer.innerHTML = '';

    // æ·»åŠ é…ç½®çš„æŠ€èƒ½
    skills.forEach(skill => {
        const skillIcon = document.createElement('div');
        skillIcon.className = 'skill-icon';
        skillIcon.title = skill.name;
        skillIcon.innerHTML = `<img src="${skill.icon}" alt="${skill.name}">`;
        skillsContainer.appendChild(skillIcon);
    });
}

function updateTexts(texts) {
    // æ›´æ–°GitHubç»Ÿè®¡åŒºåŸŸæ–‡æœ¬
    if (texts.githubStats) {
        const { githubStats } = texts;

        // æ€»æäº¤æ•°
        const totalCommitsLabel = document.getElementById('total-commits-label');
        if (totalCommitsLabel) totalCommitsLabel.textContent = githubStats.totalCommitsLabel;

        const totalCommitsText = document.getElementById('total-commits-text');
        if (totalCommitsText) {
            totalCommitsText.innerHTML = `${githubStats.totalCommitsText} <span class="highlight-number" id="total-commits">0</span> ${githubStats.totalCommitsUnit}`;
        }

        // è¿ç»­ç»Ÿè®¡
        const streakLabel = document.getElementById('streak-label');
        if (streakLabel) streakLabel.textContent = githubStats.streakLabel;

        // æ´»è·ƒåº¦
        const activityLabel = document.getElementById('activity-label');
        if (activityLabel) activityLabel.textContent = githubStats.activityLabel;

        // ä¸»è¦è¯­è¨€
        const mainLanguageLabel = document.getElementById('main-language-label');
        if (mainLanguageLabel) mainLanguageLabel.textContent = githubStats.mainLanguageLabel;
    }

    // æ›´æ–°åŒºåŸŸæ ‡é¢˜
    if (texts.sectionTitles) {
        const { sectionTitles } = texts;

        const welcomeTitle = document.getElementById('welcome-title');
        if (welcomeTitle) welcomeTitle.textContent = sectionTitles.welcome;

        const visitorIPLabel = document.getElementById('visitor-ip-label');
        if (visitorIPLabel) visitorIPLabel.textContent = sectionTitles.visitorIP;

        const websitesTitle = document.getElementById('websites-title');
        if (websitesTitle) websitesTitle.textContent = sectionTitles.websites;

        const projectsTitle = document.getElementById('projects-title');
        if (projectsTitle) projectsTitle.textContent = sectionTitles.projects;

        const skillsTitle = document.getElementById('skills-title');
        if (skillsTitle) skillsTitle.textContent = sectionTitles.skills;
    }

    // æ›´æ–°é¡µè„š
    if (texts.footer) {
        const { footer } = texts;
        const footerText = document.getElementById('footer-text');
        if (footerText) {
            footerText.innerHTML = `Â© ${footer.year} ${footer.text} <a href="${footer.authorUrl}" target="_blank">${footer.author}</a>`;
        }
    }
}

// çª—å£å°ºå¯¸å˜åŒ–çš„åŠ¨æ€é€‚é…
window.addEventListener('resize', function() {
    // å¦‚æœè°ƒè‰²ç›˜æ­£åœ¨æ˜¾ç¤ºï¼Œé‡æ–°è°ƒæ•´ä½ç½®
    const palettePanel = document.getElementById('circular-palette-panel');
    if (palettePanel && palettePanel.classList.contains('active')) {
        // ä½¿ç”¨JavaScriptä¸­ç»Ÿä¸€çš„ä½ç½®ç®¡ç†å‡½æ•°ï¼Œè€Œä¸æ˜¯ç›´æ¥è®¾ç½®CSS
        setTimeout(() => {
            // è°ƒç”¨ç»Ÿä¸€çš„è°ƒè‰²ç›˜ä½ç½®æ›´æ–°å‡½æ•°ï¼Œç¡®ä¿è·¨æµè§ˆå™¨å…¼å®¹æ€§
            if (window.paletteManager && window.paletteManager.updateVisiblePosition) {
                window.paletteManager.updateVisiblePosition();
            }
        }, 100);
    }
    
    // å¦‚æœè¿›åº¦æç¤ºæ­£åœ¨æ˜¾ç¤ºï¼Œä¹Ÿè¦é‡æ–°è°ƒæ•´
    const progressHint = document.getElementById('click-progress-hint');
    if (progressHint) {
        setTimeout(() => {
            // ä½¿ç”¨CSSç±»åç¡®ä¿å“åº”å¼æ ·å¼ç”Ÿæ•ˆ
            progressHint.className = 'click-progress-hint';
        }, 100);
    }
});

// å±å¹•æ–¹å‘å˜åŒ–æ—¶çš„å¤„ç†ï¼ˆç§»åŠ¨ç«¯ï¼‰
window.addEventListener('orientationchange', function() {
    setTimeout(() => {
        // æ–¹å‘å˜åŒ–åé‡æ–°è°ƒæ•´è°ƒè‰²ç›˜
        const palettePanel = document.getElementById('circular-palette-panel');
        if (palettePanel && palettePanel.classList.contains('active')) {
            // ä½¿ç”¨JavaScriptä¸­ç»Ÿä¸€çš„ä½ç½®ç®¡ç†å‡½æ•°ï¼Œç¡®ä¿è·¨æµè§ˆå™¨å…¼å®¹æ€§
            if (window.paletteManager && window.paletteManager.updateVisiblePosition) {
                window.paletteManager.updateVisiblePosition();
            }
        }
        
        // é‡æ–°è°ƒæ•´è¿›åº¦æç¤º
        const progressHint = document.getElementById('click-progress-hint');
        if (progressHint) {
            progressHint.className = 'click-progress-hint';
        }
    }, 300); // ç­‰å¾…æ–¹å‘å˜åŒ–åŠ¨ç”»å®Œæˆ
});
</script>
<!-- è‡ªå®šä¹‰æ ç›®æ¨¡å— -->
<script src="./modules/custom-section.js"></script>
<script src="./static/script.js"></script>
</html>
